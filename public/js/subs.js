"use strict";(()=>{function y(e,n){if(!e)return n;try{return JSON.parse(e)}catch{return n}}function l(e,n=!1){if(!n){let t=localStorage.getItem("scanpay_lastPing"),s=Math.floor(Date.now()/1e3)-300;if(t&&parseInt(t,10)>s)return Promise.resolve(parseInt(t,10))}return fetch("../wp-scanpay/fetch?x=ping&s="+e,{headers:{"X-Scanpay":"fetch"}}).then(async t=>{let s=await t.text();if(t.status!==200)throw new Error(s);return s}).then(t=>(localStorage.setItem("scanpay_lastPing",t),parseInt(t,10)))}function p(){let e=y(localStorage.getItem("scanpay_version"),{version:"",expires:0});return e.expires>Date.now()?Promise.resolve(e.version):fetch("https://api.github.com/repos/scanpay/woocommerce-scanpay/releases/latest").then(n=>{if(n.status!==200)throw new Error(n.statusText);return n.json()}).then(({tag_name:n})=>{let t=n.substring(1);return localStorage.setItem("scanpay_version",JSON.stringify({version:t,expires:Date.now()+3600*1e3})),t})}function u(e,n){let t=e.split(".").map(Number),s=n.split(".").map(Number),f=Math.max(t.length,s.length);for(let o=0;o<f;o++){let i=t[o]??0,c=s[o]??0;if(i!==c)return i>c}return!1}function r(e,n="error"){let t=document.createElement("div");t.className="wcsp-meta-alert wcsp-meta-alert-"+n,t.innerHTML=e,document.getElementById("wcsp-meta-head").appendChild(t)}function h(e){let n="";for(let t of e)n+=`<li class="wcsp-meta-li">
			<div class="wcsp-meta-li-title">${t[0]}:</div>
			<div class="wcsp-meta-li-value">${t[1]}</div>
		</li>`;document.getElementById("wcsp-meta-ul").innerHTML=n}function m(){p().then(e=>{u(e,"2.6.2")&&r(`Your scanpay plugin is <b class="scanpay-outdated">outdated</b>. Please update to ${e}
				(<a href="//github.com/scanpay/woocommerce-scanpay/releases" target="_blank">changelog</a>)`,"info")})}function g(e){l(e).then(n=>{let t=Math.floor((Math.floor(Date.now()/1e3)-n)/60);if(n===0||t>60*24*3)return r(`Your plugin is not synchronized with the Scanpay backend. Please follow the instructions
				<a href="https://wordpress.org/plugins/scanpay-for-woocommerce/#installation">here</a>.`);t>10&&r("Your scanpay extension is out of sync: "+t+"minutes since last synchronization.")})}var a=document.getElementById("wcsp-meta").dataset,d=a.secret;function w(){a.subid&&fetch("../wp-scanpay/fetch?x=sub&s="+d+" &subid="+a.subid+"&rev=0",{headers:{"X-Scanpay":"fetch"}}).then(e=>e.json()).then(e=>{let n=new Date(e.method_exp*1e3),t="success";e.retries===0&&(t="error"),e.method_exp*1e3<Date.now()&&(t="expired"),h([["Subscription ID",e.subid],["Method",e.method],["Expiration",n.toISOString().split("T")[0]],["Status",t]])}).catch(()=>{r("Error: could not load subscription details.")})}w();g(d);m();})();

"use strict";(()=>{function d(t,n){if(!t)return n;try{return JSON.parse(t)}catch{return n}}function h(t,n=!1){if(!n){let e=localStorage.getItem("scanpay_lastPing"),s=Math.floor(Date.now()/1e3)-300;if(e&&parseInt(e,10)>s)return Promise.resolve(parseInt(e,10))}return fetch("../wp-scanpay/fetch?x=ping&s="+t,{headers:{"X-Scanpay":"fetch"}}).then(async e=>{let s=await e.text();if(e.status!==200)throw new Error(s);return s}).then(e=>(localStorage.setItem("scanpay_lastPing",e),parseInt(e,10)))}function p(){let t=d(localStorage.getItem("scanpay_version"),{version:"",expires:0});return t.expires>Date.now()?Promise.resolve(t.version):fetch("https://api.github.com/repos/scanpay/woocommerce-scanpay/releases/latest").then(n=>{if(n.status!==200)throw new Error(n.statusText);return n.json()}).then(({tag_name:n})=>{let e=n.substring(1);return localStorage.setItem("scanpay_version",JSON.stringify({version:e,expires:Date.now()+3600*1e3})),e})}function m(t,n){let e=t.split(".").map(Number),s=n.split(".").map(Number),r=Math.max(e.length,s.length);for(let a=0;a<r;a++){let c=e[a]??0,l=s[a]??0;if(c!==l)return c>l}return!1}function o(t,n,e=!1){let s="<h4>"+t+"</h4>"+n;if(e){let a=document.getElementById("wcsp-set-alert-"+e);if(a)return a.innerHTML=s}let r=document.createElement("div");r.id="wcsp-set-alert-"+e,r.className="wcsp-set-alert",r.innerHTML=s,i.appendChild(r)}function g(){i.dataset.secret&&h(i.dataset.secret).then(t=>{if(console.log(t),t===0)return o("Initiate synchronization","Please click <i>'send ping'</i> to initiate the synchronization with the scanpay backend.","sync");let n=Math.floor(Date.now()/1e3)-t;if(n<400){let e=document.getElementById("wcsp-set-alert-sync");e&&e.remove(),document.getElementById("wcsp-set-nav-mtime").innerHTML=`<b>Synchronized:</b> ${n} seconds ago.`}else if(n<604800){let e=Math.floor(n/60);o("Warning: Your system may be out of sync",`More than ${e} minutes have passed since the last received ping. Please check your <i>API key</i> and click <i>'send ping'</i>.`,"sync")}else o("Warning: Your system is out of sync","A long time has passed since the last received ping. Please check your <i>API key</i> and click <i>'send ping'</i>.","sync")}).catch(t=>{o("Error: Something went wrong","Your system responded with the following error message: "+t.message,"sync")})}var i=document.getElementById("wcsp-set-alert");if(i.dataset.shopid==="0"){let t=`<span class="wcsp-set-api-info">
            You can find your Scanpay API key <a target="_blank" href="https://dashboard.scanpay.dk/settings/api">here</a>.
        </span>`,n=document.getElementById("woocommerce_scanpay_apikey");if(n){let e=n.closest("td");e&&(e.innerHTML+=t)}}else g();document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&g()});p().then(t=>{m(t,"2.6.2")&&o("There is a new version of the plugin available. ",`Your Scanpay extension (<i>2.6.2</i>) needs to be updated to ${t}
			(<a href="//github.com/scanpay/woocommerce-scanpay/releases" target="_blank">changelog</a>).`)});})();
